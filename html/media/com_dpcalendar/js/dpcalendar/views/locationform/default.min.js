!function(){"use strict";
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */
document.addEventListener("DOMContentLoaded",(function(){loadDPAssets(["/com_dpcalendar/js/dpcalendar/dpcalendar.js","/com_dpcalendar/js/dpcalendar/layouts/block/autocomplete.js"],(function(){var e=document.getElementById("jform_geocomplete"),t=document.querySelector(".dp-map"),n=function(){var n=function(){if(t.dpmap.dpMarkers.length||DPCalendar.Map.createMarker(t,{latitude:document.getElementById("jform_latitude").value,longitude:document.getElementById("jform_longitude").value,color:document.getElementById("jform_color").value},(function(e,t){e&&(document.getElementById("jform_latitude").value=e),t&&(document.getElementById("jform_longitude").value=t)})),t.dpmap.dpMarkers.length)return t.dpmap.dpMarkers[0]};[].slice.call(document.querySelectorAll("#jform_street,#jform_number,#jform_zip,#jform_city,#jform_country,#jform_province")).forEach((function(o){o.addEventListener("change",(function(o){e.value="";var a="location.loc";-1==window.location.href.indexOf("administrator")&&(a="locationform.loc"),DPCalendar.request("task="+a+"&loc="+encodeURIComponent(function(){var e=function(e){var t=document.getElementById("jform_"+e);return t?t.value+", ":""},t=e("street");if(t){var n=e("number");n&&(t=t.substr(0,t.length-2)+" "+n)}var o=e("city");if(o){var a=e("zip");a&&(o+=o.substr(0,o.length-2)+" "+a)}return t+o+e("province")+e("country")}()),(function(e){e.data.latitude?(document.getElementById("jform_latitude").value=e.data.latitude,document.getElementById("jform_longitude").value=e.data.longitude,DPCalendar.Map.moveMarker(t,n(),e.data.latitude,e.data.longitude)):(document.getElementById("jform_latitude").value=0,document.getElementById("jform_longitude").value=0)}))}))})),window.jQuery&&
// Color field doesn't fire native events
jQuery("#jform_color").change((function(e){DPCalendar.Map.clearMarkers(t),n()})),document.getElementById("jform_color").addEventListener("change",(function(e){DPCalendar.Map.clearMarkers(t),n()})),n(),DPCalendar.autocomplete.create(e),e.addEventListener("dp-autocomplete-select",(function(e){var o="location.loc";-1==window.location.href.indexOf("administrator")&&(o="locationform.loc"),DPCalendar.request("task="+o+"&loc="+encodeURIComponent(e.detail.value),(function(e){e.data&&(!function(e){[].slice.call(document.querySelectorAll(".com-dpcalendar-locationform__fields .dp-form-input")).forEach((function(e){"jform_title"!=e.id&&"jform_geocomplete"!=e.id&&(e.value="")})),document.getElementById("jform_number")&&(document.getElementById("jform_number").value=e.number);document.getElementById("jform_street")&&(document.getElementById("jform_street").value=e.street);document.getElementById("jform_city")&&(document.getElementById("jform_city").value=e.city);document.getElementById("jform_province")&&(document.getElementById("jform_province").value=e.province);document.getElementById("jform_country")&&(document.getElementById("jform_country").value=e.country);document.getElementById("jform_zip")&&(document.getElementById("jform_zip").value=e.zip);document.getElementById("jform_latitude").value=e.latitude,document.getElementById("jform_longitude").value=e.longitude,""==document.getElementById("jform_title").value&&(document.getElementById("jform_title").value=e.formated)}(e.data),DPCalendar.Map.moveMarker(t,n(),e.data.latitude,e.data.longitude))}))}))};null!=t&&(t.addEventListener("dp-map-loaded",(function(){return n()})),[t].forEach((function(e){"IntersectionObserver"in window!=0?new IntersectionObserver((function(t,n){t.forEach((function(t){t.isIntersecting&&(n.unobserve(e),loadDPAssets(["/com_dpcalendar/js/dpcalendar/map.js"],(function(){return DPCalendar.Map.create(e)})))}))})).observe(e):loadDPAssets(["/com_dpcalendar/js/dpcalendar/map.js"],(function(){return DPCalendar.Map.create(e)}))}))),e.addEventListener("dp-autocomplete-change",(function(t){var n="location.searchloc";-1==window.location.href.indexOf("administrator")&&(n="locationform.searchloc"),DPCalendar.request("task="+n+"&loc="+encodeURIComponent(t.target.value.trim()),(function(t){DPCalendar.autocomplete.setItems(e,t.data)}))})),e.parentElement.querySelector(".dp-button").addEventListener("click",(function(t){return t.preventDefault(),e.dispatchEvent(new CustomEvent("dp-autocomplete-change",{value:e.value.trim()})),!1})),[].slice.call(document.querySelectorAll(".com-dpcalendar-locationform__actions .dp-button")).forEach((function(e){e.addEventListener("click",(function(){Joomla.submitbutton("locationform."+e.getAttribute("data-task"))}))})),Joomla.submitbutton=function(e){var t=document.getElementsByName("adminForm")[0];t&&(e.indexOf("cancel")>-1||e.indexOf("delete")>-1||document.formvalidator.isValid(t))&&Joomla.submitform(e,t)}}))}))}();