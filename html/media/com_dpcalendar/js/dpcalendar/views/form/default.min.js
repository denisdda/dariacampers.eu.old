!function(){"use strict";
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */function e(){if(document.getElementById("jform_scheduling")){var e=document.getElementById("jform_rrule").value;if(e){var t=null;e.split(";").forEach((function(e){var d=e.split("=");if(0!==d.length)switch(d[0]){case"FREQ":[].slice.call(document.getElementById("jform_scheduling").querySelectorAll("input")).forEach((function(e){e.checked=e.value==d[1],e.value==d[1]&&(t=e.value),"DAILY"==d[1]&&(document.getElementById("jform_scheduling_daily_weekdays0").checked=!1,document.getElementById("jform_scheduling_daily_weekdays1").checked=!0)}));break;case"BYDAY":
// Daily without weekend
"WEEKLY"==t&&"MO,TU,WE,TH,FR"==d[1]&&(document.getElementById("jform_scheduling_daily_weekdays0").checked=!0,document.getElementById("jform_scheduling_daily_weekdays1").checked=!1,document.getElementById("jform_scheduling1").checked=!0),d[1].split(",").forEach((function(e){if("MONTHLY"==t){var d=e.length,n=e.substring(d-2,d),o=e.substring(0,d-2);-1==o&&(o="last"),o&&document.getElementById("jform_scheduling_monthly_week")._choicejs.setChoiceByValue([o]),n&&document.getElementById("jform_scheduling_monthly_week_days")._choicejs.setChoiceByValue([n])}else document.getElementById("jform_scheduling_weekly_days")._choicejs.setChoiceByValue([e])}));break;case"BYMONTHDAY":document.getElementById("jform_scheduling_monthly_options").querySelector('input[value="by_day"]').checked=!0,d[1].split(",").forEach((function(e){document.getElementById("jform_scheduling_monthly_days")._choicejs.setChoiceByValue([e])}));break;case"COUNT":document.getElementById("jform_scheduling_repeat_count").value=d[1];break;case"INTERVAL":document.getElementById("jform_scheduling_interval").value=d[1];break;case"UNTIL":var n=document.getElementById("jform_scheduling_end_date");n.value=moment.utc(d[1]).format(n.getAttribute("data-format")),n.setAttribute("data-date",d[1].substr(0,8))}})),d()}else d()}else d()}function t(){if(document.getElementById("jform_scheduling")){var e="";if(document.getElementById("jform_scheduling1").checked&&(e="FREQ=DAILY",document.getElementById("jform_scheduling_daily_weekdays0").checked&&(e="FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR")),document.getElementById("jform_scheduling2").checked){e="FREQ=WEEKLY";var t=[].slice.call(document.querySelectorAll("#jform_scheduling_weekly_days option:checked"));t.length>0&&(e+=";BYDAY=",t.forEach((function(t){return e+=t.value+","})),e=e.slice(0,-1))}if(document.getElementById("jform_scheduling3").checked)if(e="FREQ=MONTHLY",document.getElementById("jform_scheduling_monthly_options0").checked){var d=[].slice.call(document.querySelectorAll("#jform_scheduling_monthly_days option:checked"));d.length>0&&(e+=";BYMONTHDAY=",d.forEach((function(t){return e+=t.value+","})),e=e.slice(0,-1))}else{var n=[].slice.call(document.querySelectorAll("#jform_scheduling_monthly_week option:checked"));n.length>0&&(e+=";BYDAY=",n.forEach((function(t){var d=[].slice.call(document.querySelectorAll("#jform_scheduling_monthly_week_days option:checked"));if(0!=d.length){var n=t.value;"last"==n&&(n=-1),d.forEach((function(t){return e+=n+t.value+","}))}})),e.endsWith(",")&&(e=e.slice(0,-1)))}if(document.getElementById("jform_scheduling4").checked&&(e="FREQ=YEARLY"),e.length>1){var o=document.getElementById("jform_scheduling_interval").value;o>0&&(e+=";INTERVAL="+o);var l=document.getElementById("jform_scheduling_repeat_count").value;l>0&&(e+=";COUNT="+l);var c=document.getElementById("jform_scheduling_end_date"),a=moment(c.value,c.getAttribute("data-format"));a.isValid()&&(e+=";UNTIL="+a.format("YYYYMMDD")+"T235900Z")}document.getElementById("jform_rrule").value=e}}function d(){
// Disable all fields initially
document.querySelector(".dp-field-scheduling-end-date").classList.add("dp-control_hidden"),document.querySelector(".dp-field-scheduling-interval").classList.add("dp-control_hidden"),document.querySelector(".dp-field-scheduling-repeat-count").classList.add("dp-control_hidden"),document.querySelector(".dp-field-rrule").classList.add("dp-control_hidden"),document.querySelector(".dp-field-scheduling-daily-weekdays").classList.add("dp-control_hidden"),document.querySelector(".dp-field-scheduling-weekly-days").classList.add("dp-control_hidden"),document.querySelector(".dp-field-scheduling-monthly-options").classList.add("dp-control_hidden"),document.querySelector(".dp-field-scheduling-monthly-week").classList.add("dp-control_hidden"),document.querySelector(".dp-field-scheduling-monthly-week-days").classList.add("dp-control_hidden"),document.querySelector(".dp-field-scheduling-monthly-days").classList.add("dp-control_hidden"),// Scheduling field is not rendered
document.getElementById("jform_scheduling")&&(// Scheduling is not activated
document.getElementById("jform_scheduling0").checked||(// Display default fields
document.querySelector(".dp-field-scheduling-end-date").classList.remove("dp-control_hidden"),document.querySelector(".dp-field-scheduling-interval").classList.remove("dp-control_hidden"),document.querySelector(".dp-field-scheduling-repeat-count").classList.remove("dp-control_hidden"),document.querySelector(".dp-field-rrule").classList.remove("dp-control_hidden"),// Daily
document.getElementById("jform_scheduling1").checked&&document.querySelector(".dp-field-scheduling-daily-weekdays").classList.remove("dp-control_hidden"),// Weekly
document.getElementById("jform_scheduling2").checked&&document.querySelector(".dp-field-scheduling-weekly-days").classList.remove("dp-control_hidden"),// Monthly
document.getElementById("jform_scheduling3").checked&&(document.querySelector(".dp-field-scheduling-monthly-options").classList.remove("dp-control_hidden"),document.getElementById("jform_scheduling_monthly_options0").checked?document.querySelector(".dp-field-scheduling-monthly-days").classList.remove("dp-control_hidden"):(document.querySelector(".dp-field-scheduling-monthly-week").classList.remove("dp-control_hidden"),document.querySelector(".dp-field-scheduling-monthly-week-days").classList.remove("dp-control_hidden")))))}
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */function n(){var e=document.querySelector(".com-dpcalendar-eventform__overlapping");e&&(e.style.display="none",loadDPAssets(["/com_dpcalendar/js/domurl/url.js"],(function(){
// Chosen doesn't update the selected value
var t=new Url;DPCalendar.request("task=event.overlapping",(function(t){t.data.message&&(e.style.display="block",e.className="com-dpcalendar-eventform__overlapping dp-info-box"+(t.data.count?"":" dp-info-box_success"),e.innerHTML=t.data.message,e.getAttribute("data-overlapping")&&[].slice.call(document.querySelectorAll(".dp-button-apply, .button-apply, .dp-button-save, .button-save, .dp-button-save2new, .button-save-new, .dp-button-save2copy, .button-save-copy")).forEach((function(e){e.disabled=t.data.count>0})))}),DPCalendar.formToQueryString(document.querySelector(".com-dpcalendar-eventform__form"),"input:not([name=task]), select")+(t.query.e_id?"&id="+t.query.e_id:""))})))}
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */
function o(){var e=document.querySelector(".com-dpcalendar-eventform .dp-map");null!=e&&(e.addEventListener("dp-map-loaded",(function(){return l()})),[e].forEach((function(e){"IntersectionObserver"in window!=0?new IntersectionObserver((function(t,d){t.forEach((function(t){t.isIntersecting&&(d.unobserve(e),loadDPAssets(["/com_dpcalendar/js/dpcalendar/map.js"],(function(){return DPCalendar.Map.create(e)})))}))})).observe(e):loadDPAssets(["/com_dpcalendar/js/dpcalendar/map.js"],(function(){return DPCalendar.Map.create(e)}))})));var t=document.querySelector(".com-dpcalendar-eventform .dp-field-rooms");t&&0==t.querySelectorAll("option").length&&(t.style.display="none");var d=document.querySelector(".com-dpcalendar-eventform #jform_location_lookup");d&&(loadDPAssets(["/com_dpcalendar/js/dpcalendar/layouts/block/autocomplete.js"],(function(){DPCalendar.autocomplete.create(d)})),d.addEventListener("dp-autocomplete-select",(function(e){DPCalendar.request("task=event.newlocation",(function(e){if(null!=e.data.id&&null!=e.data.display){// Reset the input field
d.value="";var t=document.getElementById("jform_location_ids");-1==t._choicejs.getValue(!0).indexOf(e.data.id)&&(t._choicejs.setChoices([{value:e.data.id?e.data.id:e.data.display,label:e.data.display,selected:!0}],"value","label"),l())}}),"lookup="+e.detail.value+"&lookup_title="+e.detail.title)})),d.addEventListener("dp-autocomplete-change",(function(e){var t="location.searchloc";-1==window.location.href.indexOf("administrator")&&(t="locationform.searchloc"),DPCalendar.request("task="+t+"&loc="+encodeURIComponent(e.target.value.trim()),(function(e){return DPCalendar.autocomplete.setItems(d,e.data)}))})))}function l(){var e=document.querySelector(".com-dpcalendar-eventform .dp-map");null!=e&&null!=e.dpmap&&(e.dpmap.invalidateSize&&e.dpmap.invalidateSize(),DPCalendar.Map.clearMarkers(e),[].slice.call(document.querySelectorAll("#jform_location_ids option:checked")).forEach((function(t){var d=t.innerHTML,n=d.substring(d.lastIndexOf("[")+1,d.lastIndexOf("]")).split(":");n.length<2||0==n[0]&&0==n[1]||DPCalendar.Map.createMarker(e,{latitude:n[0],longitude:n[1],title:d})})))}
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */
document.addEventListener("DOMContentLoaded",(function(){loadDPAssets(["/com_dpcalendar/js/dpcalendar/dpcalendar.js"],(function(){var l,c;(l=document.getElementById("jform_rrule"))&&loadDPAssets(["/com_dpcalendar/js/moment/moment.js"],(function(){l.addEventListener("change",e),[].slice.call(document.querySelectorAll(".dp-field-scheduling,#jform_scheduling_monthly_options,#jform_scheduling_daily_weekdays")).forEach((function(e){e.addEventListener("click",(function(){d(),t()}))})),[].slice.call(document.querySelectorAll("#jform_scheduling_end_date, #jform_scheduling_interval, #jform_scheduling_repeat_count,#jform_scheduling_weekly_days, #jform_scheduling_monthly_days, #jform_scheduling_monthly_week_days, #jform_scheduling_monthly_week")).forEach((function(e){e.addEventListener("change",t)})),e()})),function(){loadDPAssets(["/com_dpcalendar/js/dpcalendar/layouts/block/datepicker.js","/com_dpcalendar/js/dpcalendar/layouts/block/timepicker.js"]),[].slice.call(document.querySelectorAll("#jform_all_day input")).forEach((function(e){e.addEventListener("click",(function(t){0==e.value?(document.getElementById("jform_start_date_time").style.display="inline-block",document.getElementById("jform_end_date_time").style.display="inline-block"):(document.getElementById("jform_start_date_time").style.display="none",document.getElementById("jform_end_date_time").style.display="none"),n()}))})),document.getElementById("jform_all_day0").checked||!document.getElementById("jform_all_day0").checked&&!document.getElementById("jform_all_day1").checked?(document.getElementById("jform_start_date_time").style.display="inline-block",document.getElementById("jform_end_date_time").style.display="inline-block"):(document.getElementById("jform_start_date_time").style.display="none",document.getElementById("jform_end_date_time").style.display="none");var e=DPCalendar.debounce(n,2e3);[].slice.call(document.querySelectorAll("#jform_start_date, #jform_start_date_time, #jform_end_date, #jform_end_date_time, #jform_rooms")).forEach((function(t){
// When the start date changes we need to wait till the end date get adjusted as well
t.addEventListener("change",e)})),// Because of com_fields, we need to call it with a delay
document.getElementById("jform_catid").addEventListener("change",e),e()}(),o(),0==parseInt(document.getElementById("jform_id").value)&&loadDPAssets(["/com_dpcalendar/js/domurl/url.js","/com_dpcalendar/js/dpcalendar/layouts/block/autocomplete.js"],(function(){var e=document.getElementById("jform_title");DPCalendar.autocomplete.create(e),e.addEventListener("dp-autocomplete-select",(function(e){document.querySelector("input[name=template_event_id]").value=e.detail.value,Joomla.submitbutton("event.reloadfromevent")}));var t=new Url;e.addEventListener("dp-autocomplete-change",(function(d){loadDPAssets(["/com_dpcalendar/js/dpcalendar/dpcalendar.js"],(function(){DPCalendar.request("task=event.similar",(function(t){DPCalendar.autocomplete.setItems(e,t.data)}),DPCalendar.formToQueryString(document.querySelector(".com-dpcalendar-eventform__form"),"input:not([name=task]), select")+"&id="+t.query.e_id)}))}))})),(c=document.querySelector(".dp-field-captcha"))&&document.querySelector(".com-dpcalendar-eventform__form").appendChild(c),
/**
   * @package   DPCalendar
   * @author    Digital Peak http://www.digital-peak.com
   * @copyright Copyright (C) 2007 - 2020 Digital Peak. All rights reserved.
   * @license   http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
   */
function(){document.getElementById("jform_catid").addEventListener("change",(function(e){
// If there is an external calendar, reload the form
for(var t=0;t<e.target.length;t++)if(e.target.value&&isNaN(parseInt(e.target.options[t].value))){var d=document.querySelector(".dp-loader");return d&&d.classList.remove("dp-loader_hidden"),Joomla.submitbutton("event.reload"),!0}}));var e=document.getElementById("jform_location_ids");e&&e.addEventListener("change",(function(e){if(!document.getElementById("jform_rooms"))return!0;// Only reload when it is a existing location as it can have rooms
if(!isNaN(e.detail.value)){var t=document.querySelector(".dp-loader");t&&t.classList.remove("dp-loader_hidden"),Joomla.submitbutton("event.reload")}})),[].slice.call(document.querySelectorAll(".com-dpcalendar-eventform__actions .dp-button")).forEach((function(e){e.addEventListener("click",(function(){Joomla.submitbutton("event."+e.getAttribute("data-task"))}))})),Joomla.submitbutton=function(e){var t=document.getElementsByName("adminForm")[0];if(t&&(e.indexOf("reload")>-1||e.indexOf("cancel")>-1||e.indexOf("delete")>-1||document.formvalidator.isValid(t))){var d=Joomla.JText._("COM_DPCALENDAR_VIEW_EVENT_SEND_TICKET_HOLDERS_NOFICATION");d&&(e.indexOf("save")>-1||e.indexOf("apply")>-1)&&confirm(d)&&(document.getElementById("jform_notify_changes").value=1);var n=document.querySelector(".dp-loader");n&&n.classList.remove("dp-loader_hidden"),Joomla.submitform(e,t)}}}()})),Joomla.JText._("COM_DPCALENDAR_ONLY_AVAILABLE_SUBSCRIBERS")&&[].slice.call(document.querySelectorAll(".dp-field-scheduling .controls, .dp-tabs__tab-booking .controls")).forEach((function(e){var t=document.createElement("span");t.className="dp-free-information-text",t.innerText=Joomla.JText._("COM_DPCALENDAR_ONLY_AVAILABLE_SUBSCRIBERS"),e.appendChild(t)})),loadDPAssets(["/com_dpcalendar/js/choices/choices.js","/com_dpcalendar/css/choices/choices.css"],(function(){[].slice.call(document.querySelectorAll(".com-dpcalendar-eventform select:not(#jform_color):not(#jform_tags):not(.dp-timezone__select)")).forEach((function(e){e._choicejs=new Choices(e,{itemSelectText:"",noChoicesText:"",shouldSortItems:!1,shouldSort:!1,removeItemButton:"jform_catid"!=e.id,searchResultLimit:30})}))}))}))}();